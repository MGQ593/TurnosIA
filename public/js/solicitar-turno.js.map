{
  "version": 3,
  "sources": ["../../src/frontend/solicitar-turno.ts"],
  "sourcesContent": ["/**\r\n * Sistema de Turnos - Frontend TypeScript\r\n * Formulario de solicitud de turnos con validaci\u00F3n de c\u00E9dula ecuatoriana y WhatsApp\r\n */\r\n\r\nimport type {\r\n  PublicConfig,\r\n  ValidationResult,\r\n  WhatsAppValidationResult,\r\n  FormularioTurnoData,\r\n  TurnoGuardado,\r\n  N8NResponse,\r\n  TokenResponse,\r\n  WhatsAppNumberValidation\r\n} from './types';\r\n\r\n// ============= CONSTANTES =============\r\nconst DEFAULT_LOGO_URL: string = 'https://www.chevyplan.com.ec/wp-content/uploads/2025/10/wb_chevyplan_logo-financiamiento-w_v5.webp';\r\nconst PUBLIC_CONFIG_ENDPOINT: string = '/api/config/public';\r\nconst TURNO_STORAGE_KEY: string = 'turno_actual';\r\nconst RATE_LIMIT_MS: number = 3000; // 3 segundos entre env\u00EDos\r\n\r\n// ============= VARIABLES DOM =============\r\nconst form = document.getElementById('turnoForm') as HTMLFormElement;\r\nconst loading = document.getElementById('loading') as HTMLElement;\r\nconst formShell = document.getElementById('formShell') as HTMLElement;\r\nconst successMessage = document.getElementById('successMessage') as HTMLElement;\r\nconst alertContainer = document.getElementById('alertContainer') as HTMLElement;\r\nconst turnoIdMensaje = document.getElementById('turnoIdMensaje') as HTMLElement;\r\nconst turnoIdElemento = document.getElementById('turnoId') as HTMLElement;\r\nconst submitBtn = document.getElementById('submitBtn') as HTMLButtonElement;\r\nconst cedulaInput = document.getElementById('cedula') as HTMLInputElement;\r\nconst celularInput = document.getElementById('celular') as HTMLInputElement;\r\nconst logoImg = document.getElementById('brandLogo') as HTMLImageElement;\r\nconst headerElement = document.querySelector('.header') as HTMLElement | null;\r\n\r\n// ============= VARIABLES DE CONTROL =============\r\nlet lastSubmitTime: number = 0;\r\n\r\n// ============= CONFIGURACI\u00D3N (cargada desde servidor) =============\r\nlet RESET_PARAM: string = 'nuevo';\r\nlet EXPIRATION_MINUTES: number = 30;\r\nlet WHATSAPP_API_URL: string = '';\r\nlet WHATSAPP_API_TOKEN: string = '';\r\n\r\n// ============= FUNCIONES UTILIDAD =============\r\n\r\n/**\r\n * Obtiene un par\u00E1metro de la URL\r\n */\r\nfunction obtenerParametroURL(nombre: string): string | null {\r\n    const urlParams = new URLSearchParams(window.location.search);\r\n    return urlParams.get(nombre);\r\n}\r\n\r\n/**\r\n * Verifica si un turno ha expirado seg\u00FAn el tiempo configurado\r\n */\r\nfunction turnoHaExpirado(timestamp: string): boolean {\r\n    const ahora: number = new Date().getTime();\r\n    const tiempoTurno: number = new Date(timestamp).getTime();\r\n    const diferenciaMinutos: number = (ahora - tiempoTurno) / (1000 * 60);\r\n    return diferenciaMinutos >= EXPIRATION_MINUTES;\r\n}\r\n\r\n/**\r\n * Verifica si hay un turno guardado en localStorage al cargar la p\u00E1gina\r\n */\r\nfunction verificarTurnoGuardado(): boolean {\r\n    try {\r\n        const resetParam = obtenerParametroURL('nuevo');\r\n        const turnoGuardado = localStorage.getItem(TURNO_STORAGE_KEY);\r\n        \r\n        if (turnoGuardado) {\r\n            const turnoData = JSON.parse(turnoGuardado);\r\n            \r\n            // Si viene con par\u00E1metro de reset y el par\u00E1metro es correcto\r\n            if (resetParam === 'true') {\r\n                // Verificar si ha expirado el tiempo\r\n                if (turnoHaExpirado(turnoData.timestamp)) {\r\n                    // Tiempo expirado, limpiar y permitir nuevo turno\r\n                    localStorage.removeItem(TURNO_STORAGE_KEY);\r\n                    console.log('\u2705 Turno expirado y limpiado. Nuevo turno permitido.');\r\n                    // Limpiar URL sin recargar\r\n                    window.history.replaceState({}, document.title, window.location.pathname);\r\n                    return false;\r\n                } else {\r\n                    // No ha pasado el tiempo suficiente\r\n                    const minutosRestantes = Math.ceil(EXPIRATION_MINUTES - ((new Date().getTime() - new Date(turnoData.timestamp).getTime()) / (1000 * 60)));\r\n                    mostrarAlerta(`\u23F1\uFE0F Debe esperar ${minutosRestantes} minuto(s) m\u00E1s antes de solicitar un nuevo turno.`, 'error');\r\n                    mostrarResultado(turnoData.turnoId, null);\r\n                    return true;\r\n                }\r\n            }\r\n            \r\n            // Sin par\u00E1metro de reset, verificar expiraci\u00F3n autom\u00E1tica\r\n            if (turnoHaExpirado(turnoData.timestamp)) {\r\n                localStorage.removeItem(TURNO_STORAGE_KEY);\r\n                return false;\r\n            }\r\n            \r\n            // Turno v\u00E1lido, mostrarlo\r\n            mostrarResultado(turnoData.turnoId, null);\r\n            \r\n            // Programar cierre autom\u00E1tico para el tiempo restante\r\n            const tiempoTranscurrido = (new Date().getTime() - new Date(turnoData.timestamp).getTime()) / (1000 * 60);\r\n            const tiempoRestante = EXPIRATION_MINUTES - tiempoTranscurrido;\r\n            if (tiempoRestante > 0) {\r\n                programarCierreAutomatico(tiempoRestante);\r\n            }\r\n            \r\n            return true;\r\n        }\r\n    } catch (error) {\r\n        console.error('Error al recuperar turno guardado:', error);\r\n        localStorage.removeItem(TURNO_STORAGE_KEY);\r\n    }\r\n    return false;\r\n}\r\n\r\n/**\r\n * Guarda un turno en localStorage con timestamp\r\n */\r\nfunction guardarTurno(turnoId: string): void {\r\n    try {\r\n        const turnoData: TurnoGuardado = {\r\n            turnoId: turnoId,\r\n            timestamp: new Date().toISOString()\r\n        };\r\n        localStorage.setItem(TURNO_STORAGE_KEY, JSON.stringify(turnoData));\r\n        \r\n        // Programar cierre autom\u00E1tico despu\u00E9s de la expiraci\u00F3n\r\n        programarCierreAutomatico();\r\n    } catch (error) {\r\n        console.error('Error al guardar turno:', error);\r\n    }\r\n}\r\n\r\n/**\r\n * Programa el cierre autom\u00E1tico de la ventana cuando expire el turno\r\n */\r\nfunction programarCierreAutomatico(minutosCustom?: number): void {\r\n    const minutos: number = minutosCustom || EXPIRATION_MINUTES;\r\n    const milisegundos: number = minutos * 60 * 1000;\r\n    \r\n    setTimeout(() => {\r\n        console.log('\u23F0 Tiempo de turno expirado. Cerrando ventana...');\r\n        \r\n        // Limpiar localStorage\r\n        localStorage.removeItem(TURNO_STORAGE_KEY);\r\n        \r\n        // Intentar cerrar la ventana\r\n        const cerrado = window.close();\r\n        \r\n        // Si no se pudo cerrar (la ventana no fue abierta por JS)\r\n        if (!cerrado) {\r\n            // Mostrar mensaje amigable\r\n            document.body.innerHTML = `\r\n                <div style=\"\r\n                    display: flex;\r\n                    align-items: center;\r\n                    justify-content: center;\r\n                    height: 100vh;\r\n                    background: #02539A;\r\n                    color: white;\r\n                    text-align: center;\r\n                    padding: 20px;\r\n                    font-family: system-ui, sans-serif;\r\n                    position: fixed;\r\n                    top: 0;\r\n                    left: 0;\r\n                    right: 0;\r\n                    bottom: 0;\r\n                    overflow: hidden;\r\n                \">\r\n                    <div style=\"\r\n                        background: rgba(255, 255, 255, 0.95);\r\n                        padding: 40px;\r\n                        border-radius: 24px;\r\n                        box-shadow: 0 24px 48px rgba(0, 0, 0, 0.3);\r\n                        color: #0f172a;\r\n                        max-width: 500px;\r\n                    \">\r\n                        <div style=\"font-size: 60px; margin-bottom: 20px;\">\u2705</div>\r\n                        <h1 style=\"margin-bottom: 16px; font-size: 24px;\">Sesi\u00F3n Finalizada</h1>\r\n                        <p style=\"margin-bottom: 20px; color: #475569; line-height: 1.6;\">\r\n                            Tu turno ha sido procesado. Gracias por usar nuestro sistema.\r\n                        </p>\r\n                        <p style=\"font-size: 14px; color: #64748b;\">\r\n                            Puedes cerrar esta ventana de forma segura.\r\n                        </p>\r\n                    </div>\r\n                </div>\r\n            `;\r\n        }\r\n    }, milisegundos);\r\n    \r\n    console.log(`\u23F0 Cierre autom\u00E1tico programado en ${minutos.toFixed(1)} minutos`);\r\n}\r\n\r\n// Verificar token de acceso en la URL\r\nasync function verificarAcceso() {\r\n    const urlParams = new URLSearchParams(window.location.search);\r\n    const accessToken = urlParams.get('access');\r\n\r\n    if (!accessToken) {\r\n        console.warn('\uD83D\uDEAB Acceso denegado: No hay token de acceso');\r\n        mostrarAccesoDenegado();\r\n        return false;\r\n    }\r\n\r\n    try {\r\n        const response = await fetch(`/api/token/verificar-acceso/${encodeURIComponent(accessToken)}`);\r\n        const data = await response.json();\r\n\r\n        if (!data.success) {\r\n            console.warn('\uD83D\uDEAB Acceso denegado: Token inv\u00E1lido o expirado');\r\n            mostrarAccesoDenegado();\r\n            return false;\r\n        }\r\n\r\n        console.log('\u2705 Token de acceso v\u00E1lido');\r\n        return true;\r\n    } catch (error) {\r\n        console.error('\u274C Error verificando acceso:', error);\r\n        mostrarAccesoDenegado();\r\n        return false;\r\n    }\r\n}\r\n\r\n// Mostrar mensaje de acceso denegado\r\nfunction mostrarAccesoDenegado() {\r\n    document.body.innerHTML = `\r\n        <style>\r\n            @keyframes float {\r\n                0%, 100% { transform: translate(0, 0) scale(1); }\r\n                50% { transform: translate(25px, 25px) scale(1.05); }\r\n            }\r\n            \r\n            @media (max-width: 768px) {\r\n                .access-denied-container {\r\n                    padding: 24px 16px !important;\r\n                }\r\n                .access-denied-card {\r\n                    padding: 32px 24px !important;\r\n                    max-width: 100% !important;\r\n                    width: calc(100vw - 32px) !important;\r\n                }\r\n                .access-denied-logo {\r\n                    max-width: 180px !important;\r\n                    margin-bottom: 24px !important;\r\n                }\r\n                .access-denied-icon {\r\n                    font-size: 56px !important;\r\n                }\r\n                .access-denied-title {\r\n                    font-size: 24px !important;\r\n                }\r\n                .access-denied-text {\r\n                    font-size: 15px !important;\r\n                }\r\n            }\r\n        </style>\r\n        <div class=\"access-denied-container\" style=\"\r\n            display: flex;\r\n            align-items: center;\r\n            justify-content: center;\r\n            flex-direction: column;\r\n            height: 100vh;\r\n            background: #02539A;\r\n            text-align: center;\r\n            padding: 40px 20px;\r\n            font-family: 'Inter', 'Segoe UI', system-ui, sans-serif;\r\n            position: fixed;\r\n            top: 0;\r\n            left: 0;\r\n            right: 0;\r\n            bottom: 0;\r\n            overflow: hidden;\r\n        \">\r\n            <div style=\"\r\n                content: '';\r\n                position: absolute;\r\n                display: none;\r\n            \"></div>\r\n            <div style=\"\r\n                display: none;\r\n            \"></div>\r\n            \r\n            <img \r\n                class=\"access-denied-logo\"\r\n                src=\"${DEFAULT_LOGO_URL}\" \r\n                alt=\"ChevyPlan Logo\" \r\n                style=\"\r\n                    max-width: 220px;\r\n                    height: auto;\r\n                    margin-bottom: 32px;\r\n                    position: relative;\r\n                    z-index: 1;\r\n                    filter: drop-shadow(0 4px 6px rgba(0, 0, 0, 0.2));\r\n                \"\r\n            >\r\n            \r\n            <div class=\"access-denied-card\" style=\"\r\n                background: rgba(255, 255, 255, 0.96);\r\n                backdrop-filter: blur(20px);\r\n                padding: 48px;\r\n                border-radius: 24px;\r\n                border: 1px solid rgba(148, 163, 184, 0.35);\r\n                box-shadow: 0 24px 48px rgba(15, 23, 42, 0.25);\r\n                color: #0f172a;\r\n                max-width: 500px;\r\n                width: 100%;\r\n                position: relative;\r\n                z-index: 1;\r\n            \">\r\n                <div class=\"access-denied-icon\" style=\"font-size: 64px; margin-bottom: 24px;\">\uD83D\uDEAB</div>\r\n                <h1 class=\"access-denied-title\" style=\"margin-bottom: 16px; font-size: 28px; font-weight: 700; color: #0f172a;\">Acceso Denegado</h1>\r\n                <p class=\"access-denied-text\" style=\"margin-bottom: 0; color: #475569; line-height: 1.6; font-size: 16px;\">\r\n                    El token es inv\u00E1lido, ha expirado o ha sido manipulado. Por favor, solicita un nuevo turno.\r\n                </p>\r\n            </div>\r\n        </div>\r\n    `;\r\n}\r\n\r\n// Validar c\u00E9dula ecuatoriana (algoritmo del m\u00F3dulo 10)\r\nfunction validarCedulaEcuatoriana(cedula) {\r\n    if (!/^\\d{10}$/.test(cedula)) {\r\n        return false;\r\n    }\r\n\r\n    const provincia = parseInt(cedula.substring(0, 2), 10);\r\n    if (provincia < 1 || provincia > 24) {\r\n        return false;\r\n    }\r\n\r\n    const tercerDigito = parseInt(cedula.charAt(2), 10);\r\n    if (tercerDigito >= 6) {\r\n        return false;\r\n    }\r\n\r\n    const coeficientes = [2, 1, 2, 1, 2, 1, 2, 1, 2];\r\n    const digitoVerificador = parseInt(cedula.charAt(9), 10);\r\n    let suma = 0;\r\n\r\n    for (let i = 0; i < 9; i++) {\r\n        let valor = parseInt(cedula.charAt(i), 10) * coeficientes[i];\r\n        if (valor >= 10) {\r\n            valor -= 9;\r\n        }\r\n        suma += valor;\r\n    }\r\n\r\n    const resultado = suma % 10;\r\n    const digitoEsperado = resultado === 0 ? 0 : 10 - resultado;\r\n\r\n    return digitoVerificador === digitoEsperado;\r\n}\r\n\r\n// Validar n\u00FAmero de identificaci\u00F3n (c\u00E9dula, RUC o pasaporte)\r\nfunction validarIdentificacion(identificacion) {\r\n    const limpio = identificacion.trim().toUpperCase();\r\n\r\n    if (/[A-Z]/.test(limpio)) {\r\n        if (limpio.length >= 5) {\r\n            return { valido: true, tipo: 'pasaporte' };\r\n        }\r\n        return { valido: false, mensaje: 'El pasaporte debe tener al menos 5 caracteres.' };\r\n    }\r\n\r\n    if (/^\\d+$/.test(limpio)) {\r\n        if (limpio.length === 13) {\r\n            const cedula = limpio.substring(0, 10);\r\n            const establecimiento = limpio.substring(10, 13);\r\n            \r\n            if (establecimiento !== '001') {\r\n                return { valido: false, mensaje: 'El RUC debe terminar en 001.' };\r\n            }\r\n            \r\n            if (!validarCedulaEcuatoriana(cedula)) {\r\n                return { valido: false, mensaje: 'El RUC contiene una c\u00E9dula inv\u00E1lida.' };\r\n            }\r\n            \r\n            return { valido: true, tipo: 'ruc' };\r\n        }\r\n        \r\n        if (limpio.length === 10) {\r\n            if (!validarCedulaEcuatoriana(limpio)) {\r\n                return { valido: false, mensaje: 'La c\u00E9dula ecuatoriana no es v\u00E1lida.' };\r\n            }\r\n            return { valido: true, tipo: 'cedula' };\r\n        }\r\n        \r\n        return { valido: false, mensaje: 'La c\u00E9dula debe tener 10 d\u00EDgitos o el RUC 13 d\u00EDgitos.' };\r\n    }\r\n\r\n    return { valido: false, mensaje: 'Formato de identificaci\u00F3n no v\u00E1lido.' };\r\n}\r\n\r\n// Validar si el n\u00FAmero tiene WhatsApp usando Evolution API\r\nasync function validarWhatsApp(celular) {\r\n    try {\r\n        if (!WHATSAPP_API_URL || !WHATSAPP_API_TOKEN) {\r\n            console.warn('\u26A0\uFE0F WhatsApp API no configurada, omitiendo validaci\u00F3n');\r\n            return { valido: true, advertencia: true };\r\n        }\r\n\r\n        // Limpiar el n\u00FAmero y eliminar el 0 despu\u00E9s del c\u00F3digo de pa\u00EDs\r\n        let numeroLimpio = celular.replace(/[\\s\\-\\(\\)]/g, '');\r\n        \r\n        // Si el n\u00FAmero empieza con 0, quitarlo (ej: 0981314280 \u2192 981314280)\r\n        if (numeroLimpio.startsWith('0')) {\r\n            numeroLimpio = numeroLimpio.substring(1);\r\n        }\r\n        \r\n        const numeroConPais = '593' + numeroLimpio;\r\n\r\n        console.log('\uD83D\uDD0D Validando WhatsApp para:', numeroConPais);\r\n\r\n        const response = await fetch(WHATSAPP_API_URL, {\r\n            method: 'POST',\r\n            headers: {\r\n                'Content-Type': 'application/json',\r\n                'apikey': WHATSAPP_API_TOKEN\r\n            },\r\n            body: JSON.stringify({\r\n                numbers: [numeroConPais]\r\n            })\r\n        });\r\n\r\n        if (!response.ok) {\r\n            console.warn('\u26A0\uFE0F No se pudo validar WhatsApp, continuando sin validaci\u00F3n');\r\n            return { valido: true, advertencia: true };\r\n        }\r\n\r\n        const resultado = await response.json();\r\n        console.log('\uD83D\uDCF1 Respuesta de validaci\u00F3n WhatsApp:', resultado);\r\n\r\n        if (resultado && Array.isArray(resultado) && resultado.length > 0) {\r\n            const numeroValidado = resultado[0];\r\n            \r\n            // SOLO validar con la propiedad \"exists\"\r\n            // jid existe en la respuesta incluso cuando exists=false, por eso NO lo usamos\r\n            if (numeroValidado.exists === true) {\r\n                console.log('\u2705 N\u00FAmero con WhatsApp confirmado');\r\n                return { valido: true, whatsappActivo: true, numeroWhatsApp: numeroConPais };\r\n            } else {\r\n                console.log('\u26A0\uFE0F N\u00FAmero sin WhatsApp detectado - Continuando con advertencia visual');\r\n                return { \r\n                    valido: true, // NO bloqueamos, solo advertimos\r\n                    whatsappActivo: false,\r\n                    advertencia: true,\r\n                    mensaje: 'Este n\u00FAmero no tiene WhatsApp activo'\r\n                };\r\n            }\r\n        }\r\n\r\n        console.warn('\u26A0\uFE0F Respuesta inesperada de la API, continuando sin validaci\u00F3n estricta');\r\n        return { valido: true, advertencia: true };\r\n\r\n    } catch (error) {\r\n        console.error('\u274C Error al validar WhatsApp:', error);\r\n        return { valido: true, advertencia: true };\r\n    }\r\n}\r\n\r\n// Enviar datos (simulaci\u00F3n)\r\n/**\r\n * Env\u00EDa los datos del formulario (simulaci\u00F3n por ahora)\r\n */\r\nasync function enviarAN8N(datos: FormularioTurnoData, aceptoTerminos: boolean): Promise<N8NResponse> {\r\n    const payload = {\r\n        numero_cedula: datos.cedula,\r\n        numero_celular: datos.celular,\r\n        acepto_terminos: aceptoTerminos,\r\n        timestamp: new Date().toISOString(),\r\n        origen: 'formulario_web'\r\n    };\r\n\r\n    console.log('Datos que se enviarian a n8n:', payload);\r\n\r\n    await new Promise(resolve => setTimeout(resolve, 2000));\r\n\r\n    const numeroAleatorio = Math.floor(Math.random() * 999) + 1;\r\n    const turnoId = 'T' + numeroAleatorio.toString().padStart(3, '0');\r\n    \r\n    return {\r\n        success: true,\r\n        turno_id: turnoId,\r\n        message: 'Turno creado exitosamente'\r\n    };\r\n}\r\n\r\n/**\r\n * Carga la configuraci\u00F3n p\u00FAblica desde el servidor\r\n */\r\nasync function cargarConfigPublica(): Promise<void> {\r\n    try {\r\n        const controller = new AbortController();\r\n        const timeoutId = setTimeout(() => controller.abort(), 5000);\r\n\r\n        const respuesta = await fetch(PUBLIC_CONFIG_ENDPOINT, { \r\n            cache: 'no-store',\r\n            signal: controller.signal\r\n        });\r\n        \r\n        clearTimeout(timeoutId);\r\n\r\n        if (!respuesta.ok) {\r\n            throw new Error('Respuesta inv\u00E1lida de configuraci\u00F3n');\r\n        }\r\n\r\n        const data = await respuesta.json();\r\n        \r\n        if (logoImg) {\r\n            const logoUrl = typeof data.logoUrl === 'string' && data.logoUrl.trim().length > 0\r\n                ? data.logoUrl.trim()\r\n                : DEFAULT_LOGO_URL;\r\n\r\n            logoImg.src = logoUrl;\r\n            logoImg.onerror = function() {\r\n                console.warn('Error cargando logo desde URL configurada, usando fallback');\r\n                logoImg.src = DEFAULT_LOGO_URL;\r\n            };\r\n        }\r\n        \r\n        if (data.resetParam) {\r\n            RESET_PARAM = data.resetParam;\r\n            console.log('\uD83D\uDD27 Par\u00E1metro de reset configurado:', RESET_PARAM);\r\n        }\r\n        \r\n        if (data.expirationMinutes) {\r\n            EXPIRATION_MINUTES = data.expirationMinutes;\r\n            console.log('\u23F1\uFE0F Tiempo de expiraci\u00F3n configurado:', EXPIRATION_MINUTES, 'minutos');\r\n        }\r\n\r\n        if (data.whatsappApiUrl) {\r\n            WHATSAPP_API_URL = data.whatsappApiUrl;\r\n            console.log('\uD83D\uDCF1 WhatsApp API URL configurada:', WHATSAPP_API_URL);\r\n        } else {\r\n            console.warn('\u26A0\uFE0F WhatsApp API URL no encontrada en configuraci\u00F3n');\r\n        }\r\n        \r\n        if (data.whatsappApiToken) {\r\n            WHATSAPP_API_TOKEN = data.whatsappApiToken;\r\n            console.log('\uD83D\uDD11 WhatsApp API Token configurado:', WHATSAPP_API_TOKEN.substring(0, 10) + '...');\r\n        } else {\r\n            console.warn('\u26A0\uFE0F WhatsApp API Token no encontrado en configuraci\u00F3n');\r\n        }\r\n    } catch (error) {\r\n        console.error('Error cargando configuraci\u00F3n p\u00FAblica:', error);\r\n        if (logoImg) {\r\n            logoImg.src = DEFAULT_LOGO_URL;\r\n        }\r\n    }\r\n}\r\n\r\n// Establecer estado de procesamiento\r\nfunction setProcessing(isProcessing) {\r\n    if (formShell) {\r\n        formShell.classList.toggle('is-loading', isProcessing);\r\n    }\r\n    if (loading) {\r\n        loading.classList.toggle('visible', isProcessing);\r\n    }\r\n    if (submitBtn) {\r\n        submitBtn.disabled = isProcessing;\r\n    }\r\n    if (isProcessing) {\r\n        form.setAttribute('aria-busy', 'true');\r\n    } else {\r\n        form.removeAttribute('aria-busy');\r\n    }\r\n}\r\n\r\n// Mostrar resultado del turno\r\nfunction mostrarResultado(turnoId, datos) {\r\n    if (headerElement) {\r\n        headerElement.classList.add('hidden');\r\n    }\r\n    \r\n    if (formShell) {\r\n        formShell.classList.remove('visible');\r\n        formShell.classList.add('hidden');\r\n    }\r\n    if (successMessage) {\r\n        successMessage.classList.remove('hidden');\r\n        successMessage.classList.add('visible');\r\n    }\r\n    \r\n    if (turnoId && turnoIdElemento) {\r\n        turnoIdElemento.textContent = turnoId;\r\n        guardarTurno(turnoId);\r\n    } else {\r\n        turnoIdElemento.textContent = 'N/A';\r\n    }\r\n    \r\n    if (alertContainer) {\r\n        alertContainer.innerHTML = '';\r\n    }\r\n    form.reset();\r\n    \r\n    if (cedulaInput) cedulaInput.classList.remove('error', 'success');\r\n    if (celularInput) celularInput.classList.remove('error', 'success');\r\n}\r\n\r\n// Mostrar alerta\r\nfunction mostrarAlerta(mensaje, tipo) {\r\n    if (!alertContainer) {\r\n        return;\r\n    }\r\n    const alerta = document.createElement('div');\r\n    alerta.className = 'alert alert-' + tipo;\r\n    alerta.setAttribute('role', tipo === 'error' ? 'alert' : 'status');\r\n    alerta.textContent = mensaje;\r\n    alertContainer.innerHTML = '';\r\n    alertContainer.appendChild(alerta);\r\n}\r\n\r\n/**\r\n * Carga y muestra informaci\u00F3n de la agencia desde la URL\r\n */\r\nasync function cargarInfoAgencia(): Promise<void> {\r\n    const agenciaIdParam = obtenerParametroURL('id_agencia');\r\n    \r\n    if (!agenciaIdParam) {\r\n        return; // No hay agencia en la URL\r\n    }\r\n\r\n    const agenciaId = parseInt(agenciaIdParam);\r\n    \r\n    if (isNaN(agenciaId) || agenciaId <= 0) {\r\n        console.warn('\u26A0\uFE0F ID de agencia inv\u00E1lido en URL:', agenciaIdParam);\r\n        return;\r\n    }\r\n\r\n    try {\r\n        const response = await fetch(`/api/turnos/agencia/${agenciaId}`);\r\n        \r\n        if (!response.ok) {\r\n            console.warn('\u26A0\uFE0F No se pudo cargar informaci\u00F3n de la agencia');\r\n            return;\r\n        }\r\n\r\n        const data = await response.json();\r\n        \r\n        if (data.success && data.data) {\r\n            const agencia = data.data;\r\n            const agenciaInfoElement = document.getElementById('agenciaInfo');\r\n            const agenciaNombreElement = document.getElementById('agenciaNombre');\r\n            \r\n            if (agenciaInfoElement && agenciaNombreElement) {\r\n                agenciaNombreElement.textContent = agencia.nombre;\r\n                agenciaInfoElement.style.display = 'inline-flex';\r\n                console.log(`\uD83D\uDCCD Agencia cargada: ${agencia.nombre} (ID: ${agenciaId})`);\r\n            }\r\n        }\r\n    } catch (error) {\r\n        console.error('Error cargando informaci\u00F3n de agencia:', error);\r\n    }\r\n}\r\n\r\n// Inicializar aplicaci\u00F3n\r\n(async function inicializar() {\r\n    const accesoValido = await verificarAcceso();\r\n    if (!accesoValido) {\r\n        return;\r\n    }\r\n\r\n    await cargarConfigPublica();\r\n    await cargarInfoAgencia(); // Cargar informaci\u00F3n de la agencia si est\u00E1 en la URL\r\n    \r\n    const hayTurnoGuardado = verificarTurnoGuardado();\r\n\r\n    if (!hayTurnoGuardado && celularInput) {\r\n        celularInput.focus();\r\n    }\r\n})();\r\n\r\n// Event Listeners\r\nform.addEventListener('submit', async function (event) {\r\n    event.preventDefault();\r\n    \r\n    const now = Date.now();\r\n    if (now - lastSubmitTime < RATE_LIMIT_MS) {\r\n        const remaining = Math.ceil((RATE_LIMIT_MS - (now - lastSubmitTime)) / 1000);\r\n        mostrarAlerta(`Por favor espera ${remaining} segundo(s) antes de enviar otra solicitud.`, 'error');\r\n        return;\r\n    }\r\n\r\n    const formData = new FormData(form);\r\n    const datos = {\r\n        cedula: (formData.get('cedula') || '').toString().trim(),\r\n        celular: (formData.get('celular') || '').toString().trim()\r\n    };\r\n\r\n    const aceptoTerminosCheckbox = document.getElementById('aceptoTerminos');\r\n    const aceptoTerminos = aceptoTerminosCheckbox instanceof HTMLInputElement\r\n        ? aceptoTerminosCheckbox.checked\r\n        : false;\r\n\r\n    // Capturar preferencias de notificaciones\r\n    const activarAudioCheckbox = document.getElementById('activarAudio');\r\n    const activarAudio = activarAudioCheckbox instanceof HTMLInputElement\r\n        ? activarAudioCheckbox.checked\r\n        : false;\r\n\r\n    const activarPushCheckbox = document.getElementById('activarPush');\r\n    const activarPush = activarPushCheckbox instanceof HTMLInputElement\r\n        ? activarPushCheckbox.checked\r\n        : false;\r\n\r\n    if (cedulaInput) cedulaInput.classList.remove('error', 'success');\r\n    if (celularInput) celularInput.classList.remove('error', 'success');\r\n\r\n    if (!datos.cedula || !datos.celular) {\r\n        mostrarAlerta('Todos los campos son obligatorios.', 'error');\r\n        if (!datos.cedula && cedulaInput) cedulaInput.classList.add('error');\r\n        if (!datos.celular && celularInput) celularInput.classList.add('error');\r\n        return;\r\n    }\r\n\r\n    if (!aceptoTerminos) {\r\n        mostrarAlerta('Debes autorizar el tratamiento de datos para continuar.', 'error');\r\n        return;\r\n    }\r\n\r\n    const validacionId = validarIdentificacion(datos.cedula);\r\n    if (!validacionId.valido) {\r\n        mostrarAlerta(validacionId.mensaje, 'error');\r\n        if (cedulaInput) cedulaInput.classList.add('error');\r\n        return;\r\n    }\r\n\r\n    console.log(`\u2705 Identificaci\u00F3n v\u00E1lida - Tipo: ${validacionId.tipo}`);\r\n\r\n    const celularLimpio = datos.celular.replace(/[\\s\\-\\(\\)]/g, '');\r\n    \r\n    if (!/^\\d{10}$/.test(celularLimpio) && !/^3\\d{9}$/.test(celularLimpio)) {\r\n        mostrarAlerta('Ingresa un n\u00FAmero de celular v\u00E1lido con 10 d\u00EDgitos.', 'error');\r\n        if (celularInput) celularInput.classList.add('error');\r\n        return;\r\n    }\r\n    \r\n    setProcessing(true);\r\n    mostrarAlerta('Validando n\u00FAmero de WhatsApp...', 'info');\r\n    \r\n    const validacionWhatsApp = await validarWhatsApp(datos.celular);\r\n    \r\n    // Aplicar estilos visuales seg\u00FAn el resultado de la validaci\u00F3n\r\n    if (celularInput) {\r\n        celularInput.classList.remove('error', 'success');\r\n        \r\n        if (validacionWhatsApp.whatsappActivo === true) {\r\n            // N\u00FAmero v\u00E1lido con WhatsApp activo - borde verde\r\n            celularInput.classList.add('success');\r\n            console.log('\u2705 WhatsApp activo - borde verde');\r\n        } else if (validacionWhatsApp.whatsappActivo === false) {\r\n            // N\u00FAmero sin WhatsApp - borde rojo pero NO bloqueamos\r\n            celularInput.classList.add('error');\r\n            console.warn('\u26A0\uFE0F WhatsApp no activo - borde rojo (continuando de todas formas)');\r\n        }\r\n    }\r\n\r\n    // Mostrar advertencia si el n\u00FAmero no tiene WhatsApp, pero continuar\r\n    if (validacionWhatsApp.advertencia && validacionWhatsApp.mensaje) {\r\n        mostrarAlerta(validacionWhatsApp.mensaje, 'warning');\r\n    }\r\n\r\n    if (cedulaInput) cedulaInput.classList.add('success');\r\n\r\n    lastSubmitTime = now;\r\n\r\n    try {\r\n        // Obtener agencia_id de la URL\r\n        const agenciaIdParam = obtenerParametroURL('id_agencia');\r\n        const agenciaId = agenciaIdParam ? parseInt(agenciaIdParam) : 1;\r\n        \r\n        console.log(`\uD83D\uDCCD Agencia seleccionada desde URL: ${agenciaId}`);\r\n        \r\n        // Llamar al API real para crear el turno\r\n        mostrarAlerta('Creando turno...', 'info');\r\n        \r\n        const turnoResponse = await fetch('/api/turnos/solicitar', {\r\n            method: 'POST',\r\n            headers: { 'Content-Type': 'application/json' },\r\n            body: JSON.stringify({\r\n                cliente: {\r\n                    identificacion: datos.cedula,\r\n                    tipo_identificacion: datos.cedula.length === 13 ? 'ruc' : \r\n                                       datos.cedula.length === 10 ? 'cedula' : 'pasaporte',\r\n                    celular: datos.celular\r\n                },\r\n                agencia_id: agenciaId,\r\n                whatsapp_validado: validacionWhatsApp.whatsappActivo === true // true si est\u00E1 activo, false si no\r\n            })\r\n        });\r\n\r\n        if (!turnoResponse.ok) {\r\n            const errorData = await turnoResponse.json();\r\n            throw new Error(errorData.message || 'Error creando turno');\r\n        }\r\n\r\n        const turnoData = await turnoResponse.json();\r\n        \r\n        if (turnoData.success && turnoData.data) {\r\n            // Generar token para la p\u00E1gina de confirmaci\u00F3n\r\n            const tokenResponse = await fetch('/api/token/generar-token', {\r\n                method: 'POST',\r\n                headers: { 'Content-Type': 'application/json' },\r\n                body: JSON.stringify({\r\n                    turnoId: turnoData.data.numero_turno, // Usar numero_turno (T001) en lugar de turno_id (1)\r\n                    agenciaId: turnoData.data.agencia_id,\r\n                    cedula: datos.cedula,\r\n                    celular: datos.celular,\r\n                    activarAudio,\r\n                    activarPush\r\n                })\r\n            });\r\n\r\n            if (tokenResponse.ok) {\r\n                const tokenData = await tokenResponse.json();\r\n                window.location.replace('/confirmacion?token=' + tokenData.token);\r\n            } else {\r\n                console.error('Error generando token de seguridad');\r\n                mostrarAlerta('Turno creado, pero error generando token.', 'warning');\r\n                setProcessing(false);\r\n            }\r\n        } else {\r\n            throw new Error('Respuesta inv\u00E1lida del servidor');\r\n        }\r\n    } catch (error) {\r\n        console.error('Error:', error);\r\n        mostrarAlerta('No pudimos procesar la solicitud. Intenta de nuevo en unos segundos.', 'error');\r\n        setProcessing(false);\r\n    }\r\n});\r\n\r\n// Event listeners para validaci\u00F3n en tiempo real\r\nif (cedulaInput) {\r\n    cedulaInput.addEventListener('input', function (event) {\r\n        event.target.value = event.target.value.replace(/[^A-Za-z0-9]/g, '').toUpperCase();\r\n        \r\n        const valor = event.target.value;\r\n        cedulaInput.classList.remove('error', 'success');\r\n        \r\n        if (valor.length >= 5) {\r\n            cedulaInput.classList.add('success');\r\n        }\r\n    });\r\n    \r\n    cedulaInput.addEventListener('blur', function(event) {\r\n        const valor = event.target.value.trim();\r\n        cedulaInput.classList.remove('error', 'success');\r\n        \r\n        if (valor.length > 0) {\r\n            const validacion = validarIdentificacion(valor);\r\n            if (validacion.valido) {\r\n                cedulaInput.classList.add('success');\r\n            } else {\r\n                cedulaInput.classList.add('error');\r\n            }\r\n        }\r\n    });\r\n}\r\n\r\nif (celularInput) {\r\n    celularInput.addEventListener('input', function (event) {\r\n        event.target.value = event.target.value.replace(/[^\\d\\s\\-]/g, '');\r\n        \r\n        const valor = event.target.value;\r\n        const limpio = valor.replace(/[\\s\\-\\(\\)]/g, '');\r\n        celularInput.classList.remove('error', 'success');\r\n        \r\n        if (limpio.length === 10 && /^\\d{10}$/.test(limpio)) {\r\n            celularInput.classList.add('success');\r\n        } else if (limpio.length > 10) {\r\n            celularInput.classList.add('error');\r\n        }\r\n    });\r\n    \r\n    celularInput.addEventListener('blur', function(event) {\r\n        const valor = event.target.value.trim();\r\n        const limpio = valor.replace(/[\\s\\-\\(\\)]/g, '');\r\n        celularInput.classList.remove('error', 'success');\r\n        \r\n        if (limpio.length > 0) {\r\n            if (limpio.length === 10 && /^\\d{10}$/.test(limpio)) {\r\n                celularInput.classList.add('success');\r\n            } else {\r\n                celularInput.classList.add('error');\r\n            }\r\n        }\r\n    });\r\n}\r\n"],
  "mappings": "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",
  "names": []
}
